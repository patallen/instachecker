service: instachecker

provider:
  name: aws
  runtime: python3.8
  region: us-east-1
  timeout: 10
  iamRoleStatements:
  - Effect: "Allow"
    Action:
    - dynamodb:Query
    - dynamodb:Scan
    - dynamodb:GetItem
    - dynamodb:PutItem
    - dynamodb:UpdateItem
    - dynamodb:DeleteItem
    Resource:
      Fn::GetAtt:
      - StatusTable
      - Arn

functions:
  check_stores:
    handler: instachecker.handlers.check_stores
    events:
    - schedule: cron(1/5 * * * ? *)

resources:
  Resources:
    StatusTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: StatusTable
        AttributeDefinitions:
          - AttributeName: storeId
            AttributeType: N
        KeySchema:
          - AttributeName: storeId
            KeyType: HASH
        BillingMode: PAY_PER_REQUEST

custom:
  pythonRequirements:
    dockerizePip: true
    usePoetry: true

plugins:
  - serverless-python-requirements
